# コミットルール

このドキュメントは、CommuniCareV2プロジェクトにおけるコミットメッセージのルールを定義します。

---

## コミットメッセージ形式

### 基本フォーマット

```
{種類}: {要約} #{issue番号}

{理由・詳細説明}
```

### コミット種別

- `fix`: バグ修正
- `add`: 新規（ファイル）機能追加
- `update`: 機能修正（バグではない）
- `remove`: 削除（ファイル）
- `refactor`: リファクタリング
- `docs`: ドキュメント

### 必須ルール

**コミットメッセージの末尾には必ずブランチ番号（issue番号）を付ける**

ブランチ名とissue番号を統一させ、コミットメッセージに残すことで、GitHubで追従できるようにします。

**ブランチ名の形式**:
- `features/#198` → コミットメッセージ末尾に `#198` を付ける
- `fix/#123` → コミットメッセージ末尾に `#123` を付ける
- `update/#456` → コミットメッセージ末尾に `#456` を付ける

---

## コミットメッセージ例

### ✅ 正しい例

```
add: プルリクエストルールファイルを追加 #198

プロジェクトルール整理の一環として、.cursor/rules/ディレクトリにプルリクエストに関するルールファイル（pull-request-rules.md）を追加しました。
```

```
fix: ログインエラーの修正 #123

ログイン時に発生していたエラーを修正しました。認証トークンの検証処理を改善しています。
```

```
update: ユーザー管理画面に検索機能を追加 #456

ユーザー一覧画面でユーザー名・メールアドレスによる検索ができるようにしました。
検索はリアルタイムで実行され、結果が即座に表示されます。
```

### ❌ 間違った例

```
add: プルリクエストルールファイルを追加
# issue番号が付いていない
```

```
add: プルリクエストルールファイルを追加 #198 その他の説明
# issue番号の後に追加の説明がある（issue番号は末尾に配置）
```

```
add: プルリクエストルールファイルを追加 refs #198
# refsなどの接頭辞は不要
```

---

## ブランチ名とissue番号の対応

### ブランチ命名規則

ブランチ名は以下の形式に従います：

```
{種類}/#{issue番号}
```

**種類**:
- `feature`: 新機能追加
- `fix`: バグ修正
- `update`: 既存機能の改善・更新
- `refactor`: リファクタリング
- `docs`: ドキュメント関連
- `chore`: ビルド・ツール・設定変更
- `remove`: 機能・ファイルの削除

**例**:
- `features/#198` → コミットメッセージ末尾に `#198`
- `fix/#123` → コミットメッセージ末尾に `#123`
- `update/#456` → コミットメッセージ末尾に `#456`

### issue番号の取得方法

ブランチ名からissue番号を抽出する方法：

```bash
# 現在のブランチ名を取得
git branch --show-current

# ブランチ名からissue番号を抽出（例: features/#198 → #198）
git branch --show-current | grep -o '#[0-9]*'
```

---

## コミット実行時の確認事項

コミットメッセージを作成する際は、以下を確認してください：

1. [ ] コミット種別が適切か
2. [ ] 要約が簡潔で分かりやすいか
3. [ ] **コミットメッセージの末尾にissue番号（`#{番号}`）が付いているか**
4. [ ] 詳細説明が記載されているか（必要に応じて）

---

## GitHub連携

コミットメッセージの末尾に `#{issue番号}` を付けることで、GitHubで以下のように動作します：

- コミットが該当するissueに関連付けられます
- issueのタイムラインにコミットが表示されます
- issueが自動的にクローズされる場合があります（`fix #198` や `close #198` などのキーワードを使用した場合）

**注意**: issueを自動クローズしたい場合は、コミットメッセージに `fix #198` や `close #198` などのキーワードを含める必要があります。単に `#198` だけでは関連付けのみが行われます。

---

## コミット粒度の方針

1. **1つのコミット = 1つの論理的な変更**
   - 複数の機能や修正を1つのコミットにまとめない
   - 関連する変更でも、明確に分離できる場合は別々のコミットにする

2. **小さな変更でも積極的にコミット**
   - ファイル1つの変更でも、意味のある変更であればコミットする
   - 「まだ完成していない」という理由でコミットを遅らせない

3. **機能追加とバグ修正は分離**
   - 新機能の追加とバグ修正が混在している場合は、別々のコミットにする

4. **リファクタリングは独立したコミット**
   - 機能追加やバグ修正と同時に行ったリファクタリングは、別のコミットにする

5. **テスト追加も独立したコミット**
   - テストコードの追加は、実装コードとは別のコミットにすることを検討

---

## 関連ドキュメント

- `.cursor/rules/cursor-rules.md`: プロジェクト全体のルール
- `.cursor/rules/pull-request-rules.md`: プルリクエストルール
