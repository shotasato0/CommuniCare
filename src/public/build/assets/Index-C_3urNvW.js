import{r as v,x as L,p as S,y as N,z as H,M as J,c as q,w as f,a as p,b as u,h as K,I as W,o as a,g as n,n as x,d as r,t as c,i as j,q as M,f as O,F as V,l as D,P as X,k as g}from"./app-oKiCCnFa.js";import{_ as Y,A as Z}from"./AuthenticatedLayout-B0mCR-y7.js";import ee from"./SearchForm-Bq9gKOqS.js";import"./ApplicationLogo-BEaRJJwb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Footer-DodseqVY.js";const te={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},re={class:"font-bold text-center"},se={class:"pb-12"},ae={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},oe={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},le={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},ne={class:"mb-6"},de={class:"flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:justify-between sm:items-start"},ie={key:0,class:"flex items-center space-x-4 order-1 sm:order-2"},ue={key:0,class:"mt-4 p-4 bg-red-100 dark:bg-red-900 rounded-lg"},ce={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-4 mt-12"},ge={key:0},be={class:"text-xl font-bold text-gray-800 dark:text-gray-200 border-b-2 border-gray-200 dark:border-gray-600 pb-2 mb-4"},me={class:"text-sm font-normal text-gray-600 dark:text-gray-400 ml-2"},ve={class:"grid grid-cols-1 sm:grid-cols-3 md:grid-cols-5 gap-4"},fe=["onClick"],pe={class:"flex justify-between items-start"},he={class:"font-bold text-lg text-gray-500 dark:text-gray-300 group-hover:text-red-500 dark:group-hover:text-red-400 transition-colors"},ye={class:"flex justify-between items-start"},xe={class:"font-bold text-lg text-gray-500 dark:text-gray-300 group-hover:text-black dark:group-hover:text-white transition-colors"},ke={key:1,class:"p-8 text-center text-gray-500 dark:text-gray-400"},_e={class:"text-lg font-medium"},Be={__name:"Index",props:{residents:{type:Object,required:!0},units:{type:Array,required:!0},selectedUnitId:{type:[Number,String],default:""}},setup(U){const b=U,d=v(!1),i=v(b.selectedUnitId||""),h=v(null),k=v(!1),A=e=>{e&&(h.value=e,k.value=!0,setTimeout(()=>{k.value=!1,h.value=null},8e3))};L(()=>S().props.flash,e=>{(e.success||e.error)&&A(e.success||e.error)},{immediate:!0});const m=X(),E=async e=>{await m.showDialog(`${e.name}さんを削除してもよろしいですか？`)&&N.delete(route("residents.destroy",e.id),{preserveScroll:!0,onSuccess:s=>{d.value=!1,A(s.props.flash.success)}})};L(i,e=>{N.get(route("residents.index",{unit_id:e===""?null:e}),{preserveState:!0,preserveScroll:!0})});const T=g(()=>{if(i.value==="")return"全部署";const e=b.units.find(t=>String(t.id)===String(i.value));return e?e.name:"全部署"}),B=g(()=>S().props.flash),R=e=>{const t=document.querySelectorAll(".delete-mode-button"),s=Array.from(t).some(o=>o.contains(e.target));d.value&&!s&&(d.value=!1)};H(()=>{document.addEventListener("click",R)}),J(()=>{document.removeEventListener("click",R)});const _=g(()=>B.value.success?"success":B.value.error?"error":"info"),$=g(()=>{if(i.value){const e=b.residents.filter(t=>t.unit_id===Number(i.value)).sort((t,s)=>t.name.localeCompare(s.name,"ja"));return e.length>0?{[T.value]:e}:{}}return b.units.reduce((e,t)=>{const s=b.residents.filter(o=>o.unit_id===t.id).sort((o,l)=>o.name.localeCompare(l.name,"ja"));return s.length>0&&(e[t.name]=s),e},{})}),w=v(""),C=g(()=>{const e=w.value.trim().toLowerCase();if(!e)return $.value;const t={};return Object.entries($.value).forEach(([s,o])=>{const l=o.filter(y=>y.name.toLowerCase().includes(e)).sort((y,G)=>y.name.localeCompare(G.name,"ja"));l.length>0&&(t[s]=l)}),t}),z=g(()=>Object.values(C.value).reduce((e,t)=>e+t.length,0)),Q=e=>{w.value=e},F=e=>{i.value=e},P=S(),I=g(()=>P.props.isAdmin);return(e,t)=>(a(),q(Z,null,{header:f(()=>[r("h2",te,c(e.$t("Residents")),1)]),default:f(()=>[p(Y,{"is-visible":u(m).state.isVisible,message:u(m).state.message,onConfirm:u(m).confirm,onCancel:u(m).cancel},null,8,["is-visible","message","onConfirm","onCancel"]),p(u(K),{title:e.$t("Residents")},null,8,["title"]),p(W,{"enter-active-class":"transition ease-in-out duration-300","enter-from-class":"opacity-0 transform translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition ease-in-out duration-300","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform translate-y-2"},{default:f(()=>[h.value&&k.value?(a(),n("div",{key:0,class:x([{"bg-green-100 dark:bg-green-900 border-l-4 border-green-500 dark:border-green-400 text-green-700 dark:text-green-100 p-4":_.value==="success","bg-red-100 dark:bg-red-800 border-l-4 border-red-500 dark:border-red-400 text-red-700 dark:text-red-200 p-4":_.value==="error","bg-blue-100 dark:bg-blue-800 border-l-4 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-200 p-4":_.value==="info"},"fixed bottom-10 left-1/2 transform -translate-x-1/2 w-full max-w-md mx-auto sm:rounded-lg shadow-lg z-50"])},[r("p",re,c(h.value),1)],2)):j("",!0)]),_:1}),r("div",se,[r("div",ae,[r("div",oe,[r("div",le,[r("div",ne,[r("div",de,[I.value?(a(),n("div",ie,[p(u(M),{href:e.route("residents.create"),class:"w-32 px-4 py-2 bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 rounded-md transition hover:bg-blue-300 dark:hover:bg-blue-600 hover:text-white text-center"},{default:f(()=>[...t[1]||(t[1]=[O(" 新規登録 ",-1)])]),_:1},8,["href"]),r("button",{onClick:t[0]||(t[0]=s=>d.value=!d.value),class:x(["w-32 px-4 py-2 rounded-md transition delete-mode-button bg-red-100 dark:bg-red-800 text-red-700 dark:text-red-300 hover:bg-red-300 dark:hover:bg-red-600 hover:text-white text-center",d.value?"bg-red-300 !text-white":"bg-red-200 text-red-600"])}," 削除モード ",2)])):j("",!0),p(ee,{units:U.units,"selected-unit-id":i.value,"total-results":z.value,"onUpdate:searchQuery":Q,"onUpdate:selectedUnit":F,class:"order-2 sm:order-1"},null,8,["units","selected-unit-id","total-results"])]),I.value&&d.value?(a(),n("div",ue,[...t[2]||(t[2]=[r("p",{class:"text-red-700 dark:text-red-300"}," 削除したい利用者をクリックすると削除できます。 この操作は取り消しできませんのでご注意ください。 ",-1)])])):j("",!0)]),r("div",ce,[Object.keys(C.value).length>0?(a(),n("div",ge,[(a(!0),n(V,null,D(C.value,(s,o)=>(a(),n("div",{key:o,class:"mb-8"},[r("h3",be,[O(c(o)+" ",1),r("span",me," ("+c(s.length)+"名) ",1)]),r("div",ve,[(a(!0),n(V,null,D(s,l=>(a(),n("div",{key:l.id},[d.value?(a(),n("div",{key:0,class:x(["relative block bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm transition-all text-gray-900 dark:text-gray-100 group hover:bg-red-50 dark:hover:bg-red-900 cursor-pointer"]),onClick:y=>E(l)},[r("div",pe,[r("span",he,c(l.name),1),t[3]||(t[3]=r("i",{class:"bi bi-trash text-red-500"},null,-1))])],8,fe)):(a(),q(u(M),{key:1,href:e.route("residents.show",l.id),class:x(["relative block bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm transition-all text-gray-900 dark:text-gray-100 group hover:bg-gray-50 dark:hover:bg-gray-600 hover:shadow-md"])},{default:f(()=>[r("div",ye,[r("span",xe,c(l.name),1)])]),_:2},1032,["href"]))]))),128))])]))),128))])):(a(),n("div",ke,[t[4]||(t[4]=r("i",{class:"bi bi-people text-4xl mb-2 block"},null,-1)),r("p",_e,c(w.value?"検索条件に一致する利用者が見つかりません。":"利用者が登録されていません。"),1)]))])])])])])]),_:1}))}};export{Be as default};
