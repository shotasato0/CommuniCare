import{l as H,r as u,s as J,K as X,R as Y,h as P,f as n,a as f,u as p,w as U,F as $,o as a,m as Z,b as e,t as b,G as ee,g as c,P as te,d as L,n as A,k as N,c as re,e as se,N as ae,W as oe}from"./app-BGfmsnWH.js";import le from"./Show-ZuKv-erW.js";import{A as ne,_ as de}from"./AuthenticatedLayout-CUiVAEbY.js";import{d as ie}from"./deleteItem-B-EMaGVh.js";import ue from"./UserSearchForm-D_8pKi9x.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-BvExYBVO.js";import"./Footer-C77glWd_.js";const ce={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},ge={key:0,class:"fixed bottom-10 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-green-100 dark:bg-green-900 border-l-4 border-green-500 dark:border-green-400 text-green-700 dark:text-green-100 p-4 rounded shadow-lg z-50"},pe={class:"font-bold text-center"},me={class:"pb-12"},ve={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},fe={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},be={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},xe={class:"mb-6"},he={class:"flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:justify-between sm:items-start"},ye={key:0,class:"flex items-center space-x-1 sm:space-x-4 order-1 sm:order-2"},ke={key:0,class:"mt-4 p-4 bg-red-100 dark:bg-red-900 rounded-lg"},_e={key:1,class:"mt-4 p-4 bg-purple-100 dark:bg-purple-900 rounded-lg"},we={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-4 mt-12"},Ce={class:"text-xl font-bold text-gray-800 dark:text-gray-200 border-b-2 border-gray-200 dark:border-gray-600 pb-2 mb-4"},Ue={class:"text-sm font-normal text-gray-600 dark:text-gray-400 ml-2"},Ae={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},Se=["onClick"],Ie={class:"flex items-center space-x-4"},je=["src"],Pe={class:"flex justify-between items-start w-full"},$e={class:"flex items-center"},Be={key:0,class:"flex items-center ml-2"},Me={key:0,class:"bi bi-trash text-red-500"},De={key:0,class:"text-center text-gray-500 dark:text-gray-400 mt-4 text-lg font-medium"},Ee={key:0,class:"fixed inset-0 bg-black/50 dark:bg-black/70 flex justify-center items-center z-50"},Le={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full"},Ne={class:"mb-4 text-gray-700 dark:text-gray-300"},Te={class:"flex justify-end space-x-4"},Re={__name:"Index",setup(Ve){const{props:x}=H(),h=u(x.users),B=x.currentAdminId,w=x.units,m=u(x.flash.success||null),o=u(!1),S=u(!1),I=u(null),d=u(!1),C=u(!1),y=u(null),k=u(""),M=u(""),_=ae(),T=t=>{k.value=t},V=t=>{M.value=t},D=t=>{const r=document.querySelectorAll(".admin-mode-button, .delete-mode-button"),g=Array.from(r).some(i=>i.contains(t.target));(o.value||d.value)&&!g&&(o.value=!1,d.value=!1)};J(()=>{document.addEventListener("click",D)}),X(()=>{document.removeEventListener("click",D)});const z=t=>{t.stopPropagation(),o.value=!o.value,o.value&&(d.value=!1)},F=t=>{t.stopPropagation(),d.value=!d.value,d.value&&(o.value=!1)},O=t=>{o.value||(I.value=t,S.value=!0)},Q=()=>{S.value=!1},q=async t=>{await _.showDialog(`${t.name}さんを削除してもよろしいですか？`)&&ie("user",t.id,g=>{const i=h.value.findIndex(l=>l.id===g);i!==-1&&h.value.splice(i,1),m.value="職員が削除されました",o.value=!1})},W=t=>{d.value&&(y.value=t,C.value=!0)},G=async()=>{try{await oe.post(route("admin.transferAdmin"),{new_admin_id:y.value.id},{onSuccess:()=>{m.value=`${y.value.name}に管理者権限を譲渡しました`,C.value=!1,y.value=null},onError:t=>{const r=t.message||"管理者権限の移動に失敗しました";console.error("エラー:",r),m.value=r}})}catch(t){console.error("予期しないエラー:",t),m.value="管理者権限の移動中に問題が発生しました"}};Y(()=>{if(m.value){const t=setTimeout(()=>{m.value=null},8e3);return()=>clearTimeout(t)}});const E=P(()=>B===x.auth.user.id),j=P(()=>{const t=M.value.trim().toLowerCase(),r=l=>l.filter(s=>!t||s.name.toLowerCase().includes(t)).sort((s,v)=>s.name.localeCompare(v.name,"ja"));if(k.value){const l=r(h.value.filter(s=>s.unit_id===Number(k.value)));return l.length>0?{[w.find(s=>s.id===Number(k.value)).name]:l}:{}}const g=w.reduce((l,s)=>{const v=r(h.value.filter(R=>R.unit_id===s.id));return v.length>0&&(l[s.name]=v),l},{}),i=r(h.value.filter(l=>!l.unit_id));return i.length>0&&(g.未所属=i),g}),K=P(()=>Object.values(j.value).flat().length);return(t,r)=>(a(),n($,null,[f(p(Z),{title:t.$t("Staff")},null,8,["title"]),f(ne,null,{header:U(()=>[e("h2",ce,b(t.$t("Staff")),1)]),default:U(()=>{var g;return[f(de,{"is-visible":p(_).state.isVisible,message:p(_).state.message,onConfirm:p(_).confirm,onCancel:p(_).cancel},null,8,["is-visible","message","onConfirm","onCancel"]),f(ee,{"enter-active-class":"transition ease-in-out duration-300","enter-from-class":"opacity-0 transform translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition ease-in-out duration-300","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform translate-y-2"},{default:U(()=>[m.value?(a(),n("div",ge,[e("p",pe,b(m.value),1)])):c("",!0)]),_:1}),e("div",me,[e("div",ve,[e("div",fe,[e("div",be,[e("div",xe,[e("div",he,[E.value?(a(),n("div",ye,[f(p(te),{href:t.route("register"),class:"w-32 px-4 py-2 bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 rounded-md transition hover:bg-blue-300 dark:hover:bg-blue-600 hover:text-white text-center whitespace-nowrap"},{default:U(()=>r[3]||(r[3]=[L(" 新規登録 ")])),_:1},8,["href"]),e("button",{onClick:z,class:A(["w-32 px-4 py-2 rounded-md transition delete-mode-button bg-red-100 dark:bg-red-800 text-red-700 dark:text-red-300 hover:bg-red-300 dark:hover:bg-red-600 hover:text-white text-center whitespace-nowrap",o.value?"bg-red-300 !text-white":"bg-red-200 text-red-600"])}," 削除モード ",2),e("button",{onClick:F,class:A(["w-32 px-4 py-2 rounded-md transition bg-purple-100 dark:bg-purple-800 text-purple-700 dark:text-purple-300 hover:bg-purple-300 dark:hover:bg-purple-600 hover:text-white text-center whitespace-nowrap",d.value?"bg-purple-300 !text-white":"bg-purple-200 text-purple-600"])}," 管理者権限 ",2)])):c("",!0),f(ue,{units:p(w),"selected-unit-id":k.value,"total-results":K.value,"onUpdate:selectedUnit":T,"onUpdate:searchQuery":V,class:"order-2 sm:order-1"},null,8,["units","selected-unit-id","total-results"])]),E.value&&o.value?(a(),n("div",ke,r[4]||(r[4]=[e("p",{class:"text-red-700 dark:text-red-300"}," 削除したい職員をクリックすると削除できます。 この操作は取り消しできませんのでご注意ください。 ",-1)]))):c("",!0),d.value?(a(),n("div",_e,r[5]||(r[5]=[e("p",{class:"text-purple-700 dark:text-purple-300"}," 管理者権限を他の職員に渡すことができます。 この操作を行うと、現在の管理者権限が解除されます。 ",-1)]))):c("",!0)]),e("div",we,[(a(!0),n($,null,N(j.value,(i,l)=>(a(),n("div",{key:l,class:"mb-8"},[e("h3",Ce,[L(b(l)+" ",1),e("span",Ue," ("+b(i.length)+"名) ",1)]),e("div",Ae,[(a(!0),n($,null,N(i,s=>(a(),n("div",{key:s.id,class:A(["relative block bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm transition-all text-gray-900 dark:text-gray-100 group cursor-pointer",o.value?"hover:bg-red-50 dark:hover:bg-red-900 cursor-pointer":d.value?"hover:bg-purple-50 dark:hover:bg-purple-900 cursor-pointer":"hover:bg-gray-50 dark:hover:bg-gray-600 hover:shadow-md"]),onClick:v=>o.value?q(s):d.value?W(s):O(s)},[e("div",Ie,[e("img",{src:s.iconUrl||"/images/default_user_icon.png",alt:"Profile Icon",class:"w-12 h-12 rounded-full",onError:r[0]||(r[0]=v=>v.target.src="/images/default_user_icon.png")},null,40,je),e("div",Pe,[e("div",$e,[e("span",{class:A(["font-bold text-lg transition-colors",o.value?"text-gray-500 dark:text-gray-300 group-hover:text-red-500 dark:group-hover:text-red-400":d.value?"text-gray-500 dark:text-gray-300 group-hover:text-purple-500 dark:group-hover:text-purple-400":"text-gray-500 dark:text-gray-300 group-hover:text-black dark:group-hover:text-white"])},b(s.name),3),s.id===p(B)?(a(),n("div",Be,r[6]||(r[6]=[e("i",{class:"bi bi-award-fill text-yellow-500 text-xl"},null,-1),e("span",{class:"text-xs bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 px-2 py-1 rounded-full ml-1"}," 現在の管理者 ",-1)]))):c("",!0)]),o.value?(a(),n("i",Me)):c("",!0)])])],10,Se))),128))])]))),128)),Object.keys(j.value).length===0?(a(),n("div",De," 検索条件に一致する職員が見つかりませんでした。 ")):c("",!0)])])])])]),C.value?(a(),n("div",Ee,[e("div",Le,[r[7]||(r[7]=e("h3",{class:"text-lg font-bold mb-4 text-gray-900 dark:text-gray-100"},"管理者権限の移動確認",-1)),e("p",Ne,b((g=y.value)==null?void 0:g.name)+"さんに管理者権限を渡しますか？ この操作を行うと、あなたの管理者権限は失われます。 ",1),e("div",Te,[e("button",{onClick:r[1]||(r[1]=i=>C.value=!1),class:"bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium py-2 px-4 rounded-md transition hover:bg-gray-500 dark:hover:bg-gray-500 hover:text-white focus:outline-none focus:shadow-outline"}," キャンセル "),e("button",{onClick:G,class:"px-4 py-2 rounded-md transition bg-purple-100 dark:bg-purple-800 text-purple-700 dark:text-purple-300 hover:bg-purple-300 dark:hover:bg-purple-600 hover:text-white"}," 管理者権限を渡す ")])])])):c("",!0),S.value?(a(),n("div",{key:1,class:"fixed inset-0 bg-black/50 dark:bg-black/70 flex justify-center items-center z-50",onClick:Q},[e("div",{onClick:r[2]||(r[2]=se(()=>{},["stop"]))},[I.value?(a(),re(le,{key:0,user:I.value,units:p(w)},null,8,["user","units"])):c("",!0)])])):c("",!0)]}),_:1})],64))}};export{Re as default};
